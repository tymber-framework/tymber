<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <defs>
    <!-- source: https://pictogrammers.com/library/mdi/icon/home-outline/ -->
    <symbol id="home-outline" viewBox="0 0 24 24">
      <path d="M12 5.69L17 10.19V18H15V12H9V18H7V10.19L12 5.69M12 3L2 12H5V20H11V14H13V20H19V12H22" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/magnify/ -->
    <symbol id="magnify" viewBox="0 0 24 24">
      <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/close/ -->
    <symbol id="close" viewBox="0 0 24 24">
      <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/plus/ -->
    <symbol id="plus" viewBox="0 0 24 24">
      <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/pencil-outline/ -->
    <symbol id="pencil-outline" viewBox="0 0 24 24">
      <path d="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/check/ -->
    <symbol id="check" viewBox="0 0 24 24">
      <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/undo/ -->
    <symbol id="undo" viewBox="0 0 24 24">
      <path d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z" fill="currentColor" />
    </symbol>

    <!-- source: https://pictogrammers.com/library/mdi/icon/arrow-top-right/ -->
    <symbol id="arrow-top-right" viewBox="0 0 24 24">
      <path d="M5,17.59L15.59,7H9V5H19V15H17V8.41L6.41,19L5,17.59Z" fill="currentColor" />
    </symbol>

    <!-- https://pictogrammers.com/library/mdi/icon/sort/ -->
    <symbol id="sort" viewBox="0 0 24 24">
      <path d="M18 21L14 17H17V7H14L18 3L22 7H19V17H22M2 19V17H12V19M2 13V11H9V13M2 7V5H6V7H2Z" fill="currentColor" />
    </symbol>

    <!-- https://pictogrammers.com/library/mdi/icon/sort-ascending/ -->
    <symbol id="sort-ascending" viewBox="0 0 24 24">
      <path d="M19 17H22L18 21L14 17H17V3H19M2 17H12V19H2M6 5V7H2V5M2 11H9V13H2V11Z" fill="currentColor" />
    </symbol>

    <!-- https://pictogrammers.com/library/mdi/icon/sort-ascending/ -->
    <symbol id="sort-descending" viewBox="0 0 24 24">
      <path d="M19 7H22L18 3L14 7H17V21H19M2 17H12V19H2M6 5V7H2V5M2 11H9V13H2V11Z" fill="currentColor" />
    </symbol>

    <!-- https://pictogrammers.com/library/mdi/icon/restore/ -->
    <symbol id="restore" viewBox="0 0 24 24">
      <path d="M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3Z" fill="currentColor" />
    </symbol>
  </defs>
</svg>

<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <div class="navbar-item">
      <picture style="max-height: 36px">
        <source srcset="/static/tymber-light.png" media="(prefers-color-scheme: light)" />
        <source srcset="/static/tymber-dark.png" media="(prefers-color-scheme: dark)" />
        <img src="/static/tymber-light.png" alt="Tymber logo" />
      </picture>
    </div>

    <span class="navbar-item"><%= CTX.app.name %></span>

    <div class="navbar-item">
      <span class="tag" style="color: <%= CTX.app.environment.textColor %>; background-color: <%= CTX.app.environment.color %>"><%= CTX.app.environment.name %></span>
    </div>

    <% if (!CTX.app.isProduction) { %>
    <div class="navbar-item">
      <span class="tag is-warning">Development mode</span>
    </div>
    <% } %>

    <a id="burgerButton" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div class="navbar-end">
    <div class="navbar-item">
      <div class="navbar-item has-dropdown is-hoverable">
        <div class="navbar-link">
          <%= CTX.admin.username %>
        </div>
        <div class="navbar-dropdown is-right">
          <button id="logOutButton" class="navbar-item"><%= $t("tymber.common.logOut") %></button>
        </div>
      </div>
    </div>
  </div>
</nav>

<div id="sidebar" class="sidebar menu">
  <ul class="menu-list">
    <li>
      <a href="/admin" class="<% if (CTX.path === '/admin') { %>is-active<% } %>">
        <span class="icon-text">
          <span class="icon mr-3">
            <svg width="48" height="48">
              <use xlink:href="#home-outline"></use>
            </svg>
          </span>
          <span><%= $t("tymber.common.home") %></span>
        </span>
      </a>
    </li>
  </ul>

  <% for (const module of CTX.app.modules) { %>
  <% if (module.adminSidebarItems.length === 0) { continue; } %>

  <p class="menu-label"><%= module.name %></p>

  <ul class="menu-list">
    <% for (const item of module.adminSidebarItems) { %>
    <li>
      <a href="<%= item.path %>" class="<% if (CTX.path !== '/admin' && item.path.startsWith(CTX.path)) { %>is-active<% } %>">
        <span class="icon-text">
          <span class="icon mr-3">
            <%= item.icon %>
          </span>
          <span><%= $t(item.label) %></span>
        </span>
      </a>
    </li>
    <% } %>
  </ul>
  <% } %>
</div>

<div class="overlay" id="overlay"></div>

<div class="main p-4">
  <%= VIEW %>
</div>

<script type="module">
  import { doFetch } from "./utils";

  const $burgerButton = document.getElementById("burgerButton");
  const $sidebar = document.getElementById("sidebar");
  const $overlay = document.getElementById("overlay");

  $burgerButton.addEventListener("click", () => {
    $sidebar.classList.toggle("is-active");
    $overlay.classList.toggle("is-active");
    $burgerButton.classList.toggle("is-active");
  });

  $overlay.addEventListener("click", () => {
    $sidebar.classList.remove("is-active");
    $overlay.classList.remove("is-active");
    $burgerButton.classList.remove("is-active");
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && $overlay.classList.contains("is-active")) {
      $sidebar.classList.remove("is-active");
      $overlay.classList.remove("is-active");
      $burgerButton.classList.remove("is-active");
    }
  });

  const $logOutButton = document.getElementById("logOutButton");

  $logOutButton.addEventListener("click", async () => {
    await doFetch({
      method: "POST",
      path: "/api/admin/logout"
    });
    window.location.href = "/admin/login?logged_out=1"
  });
</script>
